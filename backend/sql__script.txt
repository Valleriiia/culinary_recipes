CREATE DATABASE recipes_db;

USE recipes_db;
 
CREATE TABLE recipes
(
	id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
           	name VARCHAR(256) NOT NULL ,
           	description TEXT(10000) NOT NULL ,
	instructions TEXT(10000) NOT NULL ,
	id_category INT ,
	complexity VARCHAR(256) NOT NULL ,
	cooking_time INT NOT NULL ,
	date DATETIME NOT NULL ,
	photo VARCHAR(256) NOT NULL ,
	rating INT NOT NULL
);
 
CREATE TABLE users
(
	id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(256) NOT NULL,
	email VARCHAR(256) NOT NULL,
	password VARCHAR(256) NOT NULL
);
 
CREATE TABLE ingredients
(
	id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(200) NOT NULL,
	category VARCHAR(100)
);
 
CREATE TABLE categories
(
	id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(200) NOT NULL,
	discription TEXT(1000) NOT NULL
);
 
CREATE TABLE favorites
(
	id_recipe INT NOT NULL ,
	id_user INT NOT NULL ,
	PRIMARY KEY (id_recipe, id_user)
);
 
CREATE TABLE ratings
(
	id_user INT NOT NULL,
	id_recipe INT NOT NULL,
	rating INT NOT NULL,
	PRIMARY KEY (id_user, id_recipe)
);
 
CREATE TABLE recipes_ingredients
(
	id_recipe INT NOT NULL,
	id_ingredient INT NOT NULL,
	quantity VARCHAR(100) NOT NULL,
	PRIMARY KEY (id_recipe, id_ingredient)
);
 
CREATE TABLE reviews
(
	id_user INT NOT NULL,
	id_recipe INT NOT NULL,
	text TEXT(1000) NOT NULL,
	rating INT NOT NULL,
	date DATETIME NOT NULL,
	PRIMARY KEY (id_user, id_recipe)
);
 
ALTER TABLE favorites
ADD FOREIGN KEY (id_recipe) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE favorites
ADD FOREIGN KEY (id_user) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE ratings
ADD FOREIGN KEY (id_user) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE ratings
ADD FOREIGN KEY (id_recipe) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE reviews
ADD FOREIGN KEY (id_recipe) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE reviews
ADD FOREIGN KEY (id_user) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE recipes_ingredients
ADD FOREIGN KEY (id_recipe) REFERENCES recipes(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE recipes_ingredients
ADD FOREIGN KEY (id_ingredient) REFERENCES ingredients(id) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE recipes
ADD FOREIGN KEY (id_category) REFERENCES categories(id) ON DELETE SET NULL ON UPDATE CASCADE;
